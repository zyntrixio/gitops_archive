---
bases:
  - github.com/binkhq/postgres-to-postgres/deploy

namespace: tableau

patches:
  - target:
      kind: CronJob
    patch: |-
      - op: add
        path: /metadata/annotations/buoyant.cloud~1excluded
        value: "true"
  - target:
      kind: CronJob
    patch: |-
      - op: replace
        path: /metadata/name
        value: carina-sync-fs
  - target:
      kind: CronJob
    patch: |-
      - op: replace
        path: /spec/schedule
        value: "0 3 * * *"
  - target:
      kind: CronJob
    patch: |-
      - op: replace
        path: /spec/jobTemplate/spec/template/spec/containers/0/env
        value:
          - name: source_database_dsn
            valueFrom:
              secretKeyRef:
                key: common_placeholder
                name: azure-pgfs
          - name: source_database_name
            value: carina
          - name: destination_database_dsn
            valueFrom:
              secretKeyRef:
                key: tableau_placeholder
                name: azure-pgfs
          - name: destination_database_name
            value: carina
          - name: redis_url
            valueFrom:
              secretKeyRef:
                key: uri_ssl
                name: azure-redis-vnet
          - name: leader_election_enabled
            value: 'true'
